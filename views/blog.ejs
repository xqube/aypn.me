<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('partials/head', { title, description, url, siteUrl }) %>
</head>

<body class="bg-surface text-content min-h-screen flex flex-col">
  <%- include('partials/header') %>

    <main class="flex-1 w-full max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
      <div class="lg:grid lg:grid-cols-[1fr_240px] lg:gap-12">

        <!-- Main post list -->
        <div>
          <h1 class="font-mono text-2xl sm:text-3xl font-semibold text-heading mb-6 tracking-tight">
            Posts
          </h1>

          <!-- Search -->
          <div class="mb-8">
            <input id="search-input" type="text" placeholder="search postsâ€¦" autocomplete="off"
              class="w-full max-w-sm bg-transparent border border-line rounded px-3 py-2 text-sm font-mono text-content placeholder-faint focus:outline-none focus:border-accent transition-colors">
            <ul id="search-results" class="space-y-4 mt-6 hidden"></ul>
          </div>

          <div id="post-list">
            <% if (posts && posts.length> 0) { %>
              <ul class="space-y-6">
                <% posts.forEach(function(post) { %>
                  <li class="border-b border-line pb-6 last:border-b-0">
                    <a href="/blog/<%= post.frontmatter.slug %><%= (typeof currentPage !== 'undefined' && currentPage > 1) ? '?page=' + currentPage : '' %>"
                      class="group flex items-start gap-4">
                      <% if (post.frontmatter.coverImage) { %>
                        <div class="shrink-0 w-20 h-20 rounded-md overflow-hidden bg-surface-alt border border-line">
                          <img src="<%= post.frontmatter.coverImage %>" alt="<%= post.frontmatter.title %>"
                            loading="lazy" decoding="async"
                            class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
                        </div>
                        <% } %>
                          <div class="min-w-0 flex-1">
                            <div class="flex items-baseline gap-3 flex-wrap">
                              <time datetime="<%= post.frontmatter.date %>"
                                class="text-xs text-muted font-mono shrink-0">
                                <%= new Date(post.frontmatter.date).toLocaleDateString('en-US', { year: 'numeric' ,
                                  month: 'short' , day: 'numeric' }) %>
                              </time>
                              <% if (post.frontmatter.tags && post.frontmatter.tags.length> 0) { %>
                                <div class="flex gap-2">
                                  <% post.frontmatter.tags.forEach(function(tag) { %>
                                    <span class="text-xs font-mono text-accent/60">
                                      <%= tag %>
                                    </span>
                                    <% }); %>
                                </div>
                                <% } %>
                            </div>
                            <h2
                              class="font-mono text-lg text-heading group-hover:text-accent transition-colors duration-150 mt-1.5">
                              <%= post.frontmatter.title %>
                            </h2>
                            <% if (post.frontmatter.description) { %>
                              <p class="text-sm text-muted mt-1.5 leading-relaxed">
                                <%= post.frontmatter.description %>
                              </p>
                              <% } %>
                          </div>
                    </a>
                  </li>
                  <% }); %>
              </ul>
              <% } else { %>
                <p class="text-muted">No posts yet.</p>
                <% } %>
          </div>

          <!-- Pagination Controls -->
          <% if (totalPages> 1) { %>
            <div class="mt-12 flex items-center justify-between border-t border-line pt-6">
              <div class="flex flex-1">
                <% if (currentPage> 1) { %>
                  <a href="/blog?page=<%= currentPage - 1 %>"
                    class="font-mono text-sm text-accent hover:text-accent-hover transition-colors duration-200 flex items-center gap-2">
                    <span>&larr;</span> Newer Posts
                  </a>
                  <% } %>
              </div>
              <div class="hidden sm:block">
                <p class="font-mono text-xs text-muted">
                  Page <span class="font-medium text-heading">
                    <%= currentPage %>
                  </span> of <span class="font-medium text-heading">
                    <%= totalPages %>
                  </span>
                </p>
              </div>
              <div class="flex flex-1 justify-end">
                <% if (currentPage < totalPages) { %>
                  <a href="/blog?page=<%= currentPage + 1 %>"
                    class="font-mono text-sm text-accent hover:text-accent-hover transition-colors duration-200 flex items-center gap-2">
                    Older Posts <span>&rarr;</span>
                  </a>
                  <% } %>
              </div>
            </div>
            <% } %>
        </div>

        <!-- Right sidebar (desktop) -->
        <aside class="hidden lg:block">
          <div class="lg:sticky lg:top-20 space-y-10 lg:max-h-[calc(100vh-6rem)] lg:overflow-y-auto">
            <%- include('partials/sidebar', { latestPosts, trendingPosts }) %>
          </div>
        </aside>

      </div>

      <!-- Mobile: Latest & Trending below post list -->
      <div class="lg:hidden mt-10 pt-8 border-t border-line">
        <div class="grid grid-cols-2 gap-8">
          <%- include('partials/sidebar', { latestPosts, trendingPosts }) %>
        </div>
      </div>

    </main>

    <%- include('partials/footer') %>

      <script>
        (function () {
          var input = document.getElementById('search-input');
          var results = document.getElementById('search-results');
          var postList = document.getElementById('post-list');
          var index = null;

          function load(cb) {
            if (index) return cb();
            fetch('/api/search-index.json').then(function (r) { return r.json() }).then(function (d) { index = d; cb() });
          }

          function search(q) {
            if (!q) { results.classList.add('hidden'); postList.style.display = ''; return; }
            var terms = q.toLowerCase().split(/\s+/);
            var hits = index.filter(function (p) {
              var hay = (p.title + ' ' + p.description + ' ' + p.tags.join(' ') + ' ' + p.headings.join(' ') + ' ' + p.words).toLowerCase();
              return terms.every(function (t) { return hay.indexOf(t) !== -1; });
            });
            postList.style.display = 'none';
            results.classList.remove('hidden');
            if (!hits.length) { results.innerHTML = '<li class="text-sm text-muted font-mono">no results</li>'; return; }
            results.innerHTML = hits.map(function (p) {
              return '<li><a href="/blog/' + p.slug + '" class="group block">' +
                '<span class="font-mono text-base text-heading group-hover:text-accent transition-colors duration-150">' + p.title + '</span>' +
                (p.description ? '<p class="text-sm text-muted mt-0.5">' + p.description + '</p>' : '') +
                '</a></li>';
            }).join('');
          }

          var timer;
          input.addEventListener('input', function () {
            clearTimeout(timer);
            var q = input.value.trim();
            timer = setTimeout(function () { load(function () { search(q); }); }, 150);
          });
        })();
      </script>
</body>

</html>